#!/bin/bash

# For Vundle behind proxy
export GIT_SSL_NO_VERIFY=true

VUNDLE_DIR=~/.vim/bundle/vundle
if [ -d $VUNDLE_DIR ]; then
  cd $VUNDLE_DIR
  git pull
  cd -
else
  git clone https://github.com/gmarik/vundle.git $VUNDLE_DIR
fi

# vimrc
mv -v ~/.vimrc ~/.vimrc.old 2> /dev/null
ln -sf `pwd`/.vimrc ~/.vimrc

for d in ftplugin syntax; do
  if [ -d $d ]; then
    mkdir -pv ~/.vim/$d
    cp -rv $d/* ~/.vim/$d
  fi
done

# VimClojure-client
rm -rf vimclojure-nailgun-client*
wget http://kotka.de/projects/vimclojure/vimclojure-nailgun-client-2.3.5.zip &&
unzip vimclojure-nailgun-client-2.3.5.zip &&
cd vimclojure-nailgun-client/ &&
make &&
mkdir -p ~/bin &&
cp ng ~/bin &&
cd -

vim +BundleClean +BundleInstall +qall
if [ `vim --version | grep '+ruby' | wc -l` -eq 1 ]; then
  cd ~/.vim/bundle/Command-T/ruby/command-t
  RUBY=ruby
  [ -x '/usr/bin/ruby' ] && RUBY=/usr/bin/ruby
  make clean
  $RUBY extconf.rb
  make
fi
